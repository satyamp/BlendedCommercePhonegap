(function(){window.mmpApp={Models:{},Collections:{},Views:{},Routers:{},Helpers:{},Settings:{defaultUrl:"http://178.254.25.56"},init:function(){"use strict";var a,b,c,d=this;return document.addEventListener("deviceready",function(){var a;return a=new d.Helpers.EventHelper(d.Helpers.NFCEventHelper)}),this.appCart=new this.Collections.CartCollection,this.identity=new this.Helpers.IdentityHelper,this.appRouter=new this.Routers.ApplicationRouter,c=Modernizr.history,Backbone.history.start({pushState:!1}),b=new this.Views.RootView,b.render(),a=new this.Helpers.EventHelper(this.Helpers.PusherEventHelper)}},$(function(){"use strict";return mmpApp.init()})}).call(this),this.JST=this.JST||{},this.JST["app/scripts/templates/cart.ejs"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj){if(__p+='<div class="modal--container">\n  <div class="modal--window">\n    ',collection.models.length>0){__p+='\n      <section class="cart">\n        ';for(var i=0;i<collection.models.length;i++)__p+='\n          <div class="cart--entry">\n            <img src="http://178.254.25.56'+(null==(__t=collection.models[i].attributes.default_image)?"":__t)+'" class="cart--entry-thumbnail">\n            <div class="cart--entry-info">\n              <h3 class="headline-h3">'+(null==(__t=collection.models[i].attributes.name)?"":__t)+'</h3>\n              <span class="cart--entry-meta">\n                '+(null==(__t=collection.models[i].attributes.quantity)?"":__t)+' Stk.\n              </span>\n            </div>\n            <div class="cart--entry-price">\n              '+(null==(__t=collection.models[i].attributes.total)?"":__t)+"€\n            </div>\n          </div>\n        ";__p+='\n        <div class="cart--entry total">\n          <div class="cart--entry-price">\n            '+(null==(__t=Math.round(100*collection.getTotal())/100)?"":__t)+'€\n          </div>\n        </div>\n      </section>\n      <div class="cart--actions">\n        <a href="#" class="button primary full-width">Zur Kasse</a>\n        <a href="#" class="button inverse full-width close">Weiter Einkaufen</a>\n    </div>\n    '}else __p+='\n      <div class="cart cart--empty">\n        <h2>Deine Tasche ist leer</h2>\n      </div>\n    ';__p+="\n  </div>\n</div>\n"}return __p},this.JST["app/scripts/templates/cartBadge.ejs"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+=(null==(__t=getCount())?"":__t)+"\n";return __p},this.JST["app/scripts/templates/product.ejs"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<a href="" id="backLink" class="header--button">&lsaquo;</a>\n\n<img src="http://178.254.25.56/'+(null==(__t=attributes.media.default_image)?"":__t)+'" class="article--image">\n\n<div class="article--content">\n  <div class="article--intro">\n    <h1 class="headline-h2">'+(null==(__t=attributes.product_data.name)?"":__t)+"</h1>\n    <p>"+(null==(__t=attributes.product_data.short_description)?"":__t)+'</p>\n  </div>\n\n  <div class="article--box article--actions">\n    <div class="article--price">'+(null==(__t=attributes.product_data.price)?"":__t)+' €</div>\n    <div class="article--size">\n      <span class="attribute-label">Ihre Größe</span>\n      <span class="attribute-value">M</span>\n    </div>\n    <div class="article--buttons">\n      <a href="#" id="addToCart" class="button primary full-width">In meine Tasche</a>\n      <a href="#" id="fakeCheckout" class="button inverse full-width">Fake Checkout</a>\n    </div>\n  </div>\n\n  <div class="article--details">\n    <h2 class="headline-h3">Weitere Details</h3>\n    <p>'+(null==(__t=attributes.product_data.description)?"":__t)+'</p>\n  </div>\n\n  <div class="article--box article--related">\n    <h2 class="headline-h3">Dazu passt</h2>\n  </div>\n\n</div>\n';return __p},this.JST["app/scripts/templates/root.ejs"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div id="rootView">\n  <h1 class="headline-h1">Scan something</h1>\n  <p class="larger">Halte Dein Handy über einen der roten Punkte im Laden um mehr Informationen zum Produkt zu erhalten.</p>\n\n  <div id="interactionPlaceholder">\n  </div>\n\n</div>\n';return __p},function(){"use strict";var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};mmpApp.Models.ProductModel=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.url=function(){var a;return a=this.id,""+mmpApp.Settings.defaultUrl+"/product/"+a+".json"},d.prototype.addToCart=function(a){var b;return b=this.attributes.product_data.id,$.get(""+mmpApp.Settings.defaultUrl+"/product/"+b+"/buy.json",{identity:mmpApp.identity.getIdentity()},function(b){return a(b)})},d.prototype.checkout=function(a){return $.get(""+mmpApp.Settings.defaultUrl+"/order.json",{identity:mmpApp.identity.getIdentity()},function(b){return a(b)})},d}(Backbone.Model)}.call(this),function(){"use strict";var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};mmpApp.Routers.ApplicationRouter=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.initialize=function(){return this.productView=new mmpApp.Views.ProductView,this.cartBadge=new mmpApp.Views.CartbadgeView(mmpApp.appCart),this.cartBadge.render(),mmpApp.appCart.fetch()},d.prototype.routes={"":"rootRoute","product/:id":"showProduct"},d.prototype.rootRoute=function(){var a;return a=new mmpApp.Views.RootView,a.render()},d.prototype.showProduct=function(a){var b,c,d=this;return c=new mmpApp.Models.ProductModel({id:a}),b=c.fetch(),b.done(function(){return d.productView.addModel(c),d.productView.render()})},d}(Backbone.Router)}.call(this),function(){"use strict";var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};mmpApp.Views.ProductView=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.template=JST["app/scripts/templates/product.ejs"],d.prototype.el="#app-body",d.prototype.events={"click #addToCart":"addToCart","click #fakeCheckout":"fakeCheckout","click #backLink":"back"},d.prototype.addModel=function(a){return this.model=a},d.prototype.render=function(){var a,b;return this.$el.html(this.template(this.model)),b=0,a=100,$(window).on("scroll",function(){var c;return c=$(this).scrollTop(),Math.abs(b-c)<=a?void 0:(c>b?$(".header--button").addClass("toggled"):$(".header--button").removeClass("toggled"),b=c)})},d.prototype.addToCart=function(a){return a.preventDefault(),this.model.addToCart(function(){return mmpApp.appCart.fetch()})},d.prototype.fakeCheckout=function(a){return a.preventDefault(),this.model.checkout(function(){return console.log("do something")})},d.prototype.back=function(a){return a.preventDefault(),mmpApp.appRouter.navigate("/",{trigger:!0})},d}(Backbone.View)}.call(this),function(){"use strict";var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};mmpApp.Views.RootView=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.template=JST["app/scripts/templates/root.ejs"],d.prototype.el="#app-body",d.prototype.render=function(){return this.$el.html(this.template())},d.prototype.showProduct=function(a){return a.preventDefault(),mmpApp.appRouter.navigate("product/chpmnd1",{trigger:!0})},d}(Backbone.View)}.call(this),function(){mmpApp.Helpers.EventHelper=function(){function a(a){this.adapter=new a,this.adapter.listen(this)}return a.prototype.showProduct=function(a){return mmpApp.appRouter.navigate("product/"+a,{trigger:!0})},a}()}.call(this),function(){mmpApp.Helpers.PusherEventHelper=function(){function a(){this.pusher=new Pusher("53fcdc31927d1aaf9cdd"),this.channel=this.pusher.subscribe("test_channel")}return a.prototype.listen=function(a){return this.channel.bind("showProduct",function(b){return a.showProduct(b.id)})},a}()}.call(this),function(){mmpApp.Helpers.NFCEventHelper=function(){function a(){this.nfc=nfc,this.events={showProduct:function(a,b){return b.showProduct(a)}}}return a.prototype.listen=function(a){var b=this;return this.nfc.addNdefListener(function(c){var d,e,f,g,h;return h=c.tag,g=h.ndefMessage,f=nfc.bytesToString(g[0].payload).substring(3).split(":"),e=f[0],d=f[1],b.events[e](d,a)},function(){return console.log("Waiting for tag")},function(){return alert("Bad NFC error")})},a}()}.call(this),function(){mmpApp.Helpers.IdentityHelper=function(){function a(){this.identity=null!=("undefined"!=typeof device&&null!==device?device.uuid:void 0)?device.uuid:"test"}return a.prototype.getIdentity=function(){return this.identity},a}()}.call(this),function(){"use strict";var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};mmpApp.Models.CartitemModel=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments)}return c(d,b),d}(Backbone.Model)}.call(this),function(){"use strict";var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};mmpApp.Collections.CartCollection=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.model=mmpApp.Models.CartitemModel,d.prototype.url=function(){return""+mmpApp.Settings.defaultUrl+"/cart.json?identity="+mmpApp.identity.getIdentity()},d.prototype.parse=function(a){return a.order_items},d.prototype.getTotal=function(){return this.models.map(function(a){return parseFloat(a.attributes.total)}).reduce(function(a,b){return a+b})},d.prototype.getCount=function(){return 0===this.length?0:this.models.map(function(a){return a.attributes.quantity}).reduce(function(a,b){return a+b})},d}(Backbone.Collection)}.call(this),function(){"use strict";var a,b,c={}.hasOwnProperty,d=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};mmpApp.Views.CartbadgeView=function(b){function c(){return a=c.__super__.constructor.apply(this,arguments)}return d(c,b),c.prototype.template=JST["app/scripts/templates/cartBadge.ejs"],c.prototype.el="#cartLink",c.prototype.events={click:"showCart"},c.prototype.initialize=function(a){return this.collection=a,this.collection.on("add change",this.render,this),this.detailView=new mmpApp.Views.CartView(this.collection)},c.prototype.render=function(){return this.$el.html(this.template(this.collection))},c.prototype.showCart=function(a){return a.preventDefault(),this.detailView.render()},c}(Backbone.View),mmpApp.Views.CartView=function(a){function c(){return b=c.__super__.constructor.apply(this,arguments)}return d(c,a),c.prototype.template=JST["app/scripts/templates/cart.ejs"],c.prototype.el="#app-body",c.prototype.events={"click .close":"unrender"},c.prototype.initialize=function(a){this.collection=a},c.prototype.unrender=function(a){return a.preventDefault(),this.$el.find(".modal--container").fadeOut(500,function(){return $(this).remove()})},c.prototype.render=function(){return this.$el.find(".modal--container").remove(),this.modal=this.template({collection:this.collection}),this.$el.append(this.modal),this.$el.find(".modal--container").fadeIn()},c}(Backbone.View)}.call(this);